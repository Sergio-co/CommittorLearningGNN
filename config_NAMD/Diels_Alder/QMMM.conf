##START HERE###
##Simulation Template##

set num_replicas 32
cutoff 16
pairlistdist 18.0
switching off
exclude scaled1-4
1-4scaling     0.833333
rigidbonds all

# Simulation conditions
amber                   yes
coordinates             LIG_dry.pdb
parmfile                LIG_dry.prmtop


# Simulation conditions
temperature 300


# Output Parameters

binaryoutput no
outputname QMMM.[myReplica]
outputenergies 10
outputtiming 10
outputpressure 10
binaryrestart yes
dcdfile QMMM.[myReplica].dcd
dcdfreq 10
XSTFreq 10
restartfreq 10
restartname QMMM.[myReplica].restart


# Thermostat Parameters
langevin on
langevintemp 300
langevinHydrogen    on
langevindamping 5


# Integrator Parameters

timestep 0.5
firstTimestep 0
fullElectFrequency 1
nonbondedfreq 1
stepspercycle   1


#Implicit Solvent Parameters

gbis off

# Truns ON or OFF the QM calculations

qmForces on

#printExclusions on

# Name of a secondary PDB file where the OCCupancy
# or BETA column has the indications for QM or MM atoms.

qmParamPDB inp_QwikMD_qm-input.pdb

# Indicates qhich column has the QM/MM field.

qmColumn beta

# Number of simultaneous QM simulations per node

QMSimsPerNode 1

# Indicates qhich column has the QM-MM bond information.

qmBondColumn occ
QMSwitching on

# This option is used to decide which kind of function will be used to scale
# down point charges sent to QM calculations.

QMSwitchingType Switch

# This will alter the point charges presented to the QM system.

QMPointChargeScheme Round

# Directory where QM calculations will be ran.

qmBaseDir "[pwd]/qmmm_exec/QMMM"

# Indicates to NAMD that ALL forces form NAMD will be ignored and only
# the gradients from the QM software will be applied on the atoms.

qmReplaceAll    OFF

# The QM code will change all QM atom's VdW types to "q"+element for VdW interactions.

QMVdWParams off

# Indicates that no Poitn Charges should be selected and applied in 
# QM systems.

qmElecEmbed On

# Sets a stride for new point charge determination.

QMPCStride      1

# Indicates that one or more files will be provided with a custom selection
# of point charges.

QMCustomPCSelection     off

# The file will have, in the "qmColumn", the same QM ID provided for a single QM group.

QMCustomPCFile  input-CustomPC-1.0.pdb


# With Live Solvent Selection, NAMD will automatically keep track of the 
# solvent molecules for all QM Groups, and will exchange classical solvent
# molecules with QM solvent molecules every "QMLSSFreq" steps.

QMLiveSolventSel off

# This indicate which residue type will be used in LSS.

QMLSSResname      TIP3

# Frequency of LSS.

QMLSSFreq         50

# For LSS, this indicates how solvent molecules are selected.

QMLSSMode       dist


# This will indicate which residues are to be used in the determination of the 
# COM of non-solvent QM atoms.

QMLSSRef        "1 RP1 9"


# Multiplicity of the QM region. 

qmMult 1 1

# Indicates the charge of each QM region.

qmCharge 1 1.00


# Indicates which QM software should be used.

qmSoftware custom

# Path to the executable

qmExecPath "[pwd]/runXTB.py"

# Charge mode expected from the QM software. 

QMChargeMode mulliken

# Frequency of QM charge output.

QMOutStride     1

# Frequency of QM ONLY position output.

QMPositionOutStride     1


# ABF SECTION

colvars              on
colvarsConfig        Distance_ref.in

# Number of steps in the QM/MM simulation

# Script
run 4000000

set file [open QMMM.[myReplica].check w+]
set done 1
if {[file exists QMMM.[myReplica].restart.coor] != 1 || [file exists QMMM.[myReplica].restart.vel] != 1 || [file exists QMMM.[myReplica].restart.xsc] != 1 } {
	 set done 0
}
if {$done == 1} {
	puts $file "DONE"
    flush $file
  close $file
} else {
	puts $file "One or more files failed to be written"
   flush $file
  close $file
}
